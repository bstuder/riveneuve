$(function(){window.location.hostname.match(/localhost|127\.0\.0\.1|192\.168\.0/)||"https:"==window.location.protocol||(window.location.href="https:"+window.location.href.substring(window.location.protocol.length))});
function reloadM(a,b){if(checkChanges()){b=$(a).val();var c="",c=""==location.search||location.search.match(/\?m=-?\d+$/)?"?m="+b:location.search.match(/\?y=\d+$/)?location.search.replace(/\?/,"?m="+b+"&"):location.search.replace(/m=-?\d+/,"m="+b);location.href=location.pathname+c}else $(a).val(b)}
function reloadY(a,b){if(checkChanges()){b=$(a).val();var c="",c=""==location.search||location.search.match(/\?y=\d+$/)?"?y="+b:location.search.match(/\?m=-?\d+$/)?location.search+"&y="+b:location.search.replace(/y=\d+/,"y="+b);location.href=location.pathname+c}else $(a).val(b)}function notified(){$.post("/notified");$("#notify").attr("id","notnotify");$("#notnotify").html("Pas de nouvel \u00e9v\u00e9nement")}
function saveData(){var a=$("#saveButton"),b=a.attr("class");-1==b.indexOf("disabled")&&(a.attr("class",b+" disabled"),$("#submit").click())}function isSecure(a,b){var c=/[A-Z]/.test(b),d=/[a-z]/.test(b),e=/[0-9]/.test(b),f=/(\S.*?){7,}/.test(b);if(2>c+d+e)a.html("Le mot de passe doit contenir 2 des 3 cat\u00e9gories : <ul><li>Majucule</li><li>minuscule</li><li>chiffre</li></ul>");else{if(f)return!0;a.html("Le mot de passe doit faire au moins 7 caract\u00e8res.")}return!1}
$(function(){$("#form_login").submit(function(a){a.preventDefault();a=$("#inputUsername").val();var b=$("#inputPassword").val(),c=$("#error_login");$.post("/submit_login",{username:a,password:b},function(b){if("ok"==b)window.location="/calendar_view";else var a="ok"==b.substring(0,2)?"is_info":"is_error";c.attr("class",a);c.html(b.substring(2))})});$("#form_first").submit(function(a){a.preventDefault();a=$("#firstUsername").val();var b=$("#inputPassword1").val(),c=$("#inputPassword2").val(),d=$("#error_login");
b!=c?d.attr("class","is_error").html("Les mots de passe diff\u00e8rent."):isSecure(d,b)?$.post("/submit_first",{username:a,password:b},function(b){var a="ok"==b.substring(0,2)?"is_info":"is_error";d.attr("class",a).html(b.substring(2))}):d.attr("class","is_error")})});function toggleVisibility(){$("#form_first").toggle()}
$(function(){$("#form_reset").submit(function(a){a.preventDefault();a=$("#currentPassword").val();var b=$("#inputPassword1").val(),c=$("#inputPassword2").val(),d=$("#error_reset");b!=c?d.attr("class","is_error").html("Les deux mots de passe ne correspondent pas."):isSecure(d,b)?$.post("/submit_password",{passc:a,passn:b},function(b){var a="ok"==b.substring(0,2)?"is_info":"is_error";d.attr("class",a).html(b.substring(2))}):d.attr("class","is_error")})});
$(function(){$("#signup").submit(function(a){a.preventDefault();a=$("#abrege").val();var b=$("#complete").val(),c=$("#isadmin").prop("checked");c&&!confirm("Voulez-vous vraiment cr\u00e9er un utilisateur avec les droits administrateur?")||$.post("/submit_signup",{name:a,username:b,isadmin:c},function(a){var e=$("#error_signup");"ok"==a.substring(0,2)?($("#regusers").append("<div name="+b+"><li>"+b+"</li></div>"),$("#submit_reset").append("<option>"+b+"</option>"),$("#submit_delete").append("<option>"+
b+"</option>"),$(c?"#submit_remove":"#submit_add").append("<option>"+b+"</option>"),e.attr("class","is_info")):e.attr("class","is_error");e.html(a.substring(2));$("#isadmin").prop("checked",!1)})});$("#resetpass").submit(function(a){a.preventDefault();confirm("Voulez-vous vraiment r\u00e9initialiser le mot de passe de cet utilisateur?")&&$.post("/submit_reset_password",{username:$("#submit_reset").val()},function(b){var a="ok"==b.substring(0,2)?"is_info":"is_error";$("#error_reset").attr("class",
a).html(b.substring(2))})});$("#adminremove").submit(function(a){a.preventDefault();var b=$("#submit_remove option:selected").val();""!=b&&confirm("Voulez-vous vraiment retirer les droits administrateur de l'utilisateur?")&&$.post("/submit_remove_admin",{username:b},function(a){"ok"==a.substring(0,2)?($("#submit_add").append("<option>"+b+"</option>"),$("#submit_remove option:selected").remove()):$("#error_admin").attr("class","is_error").html(a.substring(2))})});$("#adminadd").submit(function(a){a.preventDefault();
var b=$("#submit_add").val();""!=b&&confirm("Voulez-vous vraiment ajouter des droits administrateur \u00e0 l'utilisateur?")&&$.post("/submit_add_admin",{username:b},function(a){"ok"==a.substring(0,2)?($("#submit_remove").append("<option>"+b+"</option>"),$("#submit_add option:selected").remove()):$("#error_admin").attr("class","is_error").html(a.substring(2))})});$("#deleteuser").submit(function(a){a.preventDefault();var b=$("#submit_delete").val();confirm("Voulez-vous vraiment supprimer cet utilisateur?")&&
$.post("/submit_delete",{username:b},function(a){var d=$("#error_delete");"ok"==a.substring(0,2)?($("#regusers div[name="+b+"]").remove(),$("#submit_delete option:selected").remove(),$("#submit_add option").filter(function(a,c){return c.value==b}).remove(),$("#submit_remove option").filter(function(a,c){return c.value==b}).remove(),$("#submit_reset option").filter(function(a,c){return c.value==b}).remove(),d.attr("class","is_info")):d.attr("class","is_error");d.html(a.substring(2))})})});
$(function(){$(".sortable").sortable();$(".sortable").disableSelection();$("#addcatBut").button().click(function(a){a.preventDefault();addcat()});$("#addsubcatBut").button().click(function(a){a.preventDefault();addsubcat()});$("#saveBut").button().click(function(a){a.preventDefault();saveState()});$("#rename_cat_but").button().click(function(a){a.preventDefault();renameCat()});$("#rename_subcat_but").button().click(function(a){a.preventDefault();renameSubcat()})});
function delayReload(){setTimeout(function(){window.location.reload()},200)}function deleteCat(a){confirm("Voulez-vous vraiment supprimer la cat\u00e9gorie '"+a+"' ?")&&$.post("/submit_delete_title",{title:a},function(a){delayReload()})}function deleteSubCat(a,b){confirm("Voulez-vous vraiment supprimer la sous-cat\u00e9gorie '"+b+"' ?")&&$.post("/submit_delete_subtitle",{title:a,subtitle:b},function(a){delayReload()})}
function addcat(){$.post("/submit_add_title",{title:$("#catfield").val()},function(a){delayReload()})}function addsubcat(){var a=$("#catselect").val(),b=$("#subcatfield").val();$.post("/submit_add_subtitle",{title:a,subtitle:b},function(a){delayReload()})}function renameCat(){var a=$("#catselect_r").val(),b=$("#cat_new_name").val();""!=b&&confirm("Voulez-vous vraiment renommer la cat\u00e9gorie '"+a+"' en '"+b+"' ?")&&$.post("/submit_rename_title",{cat:a,newname:b},function(a){delayReload()})}
function renameSubcat(){var a=$("#subcatselect_r").val(),b=$("#subcat_new_name").val();""!=b&&confirm("Voulez-vous vraiment renommer la sous-cat\u00e9gorie '"+a+"' en '"+b+"' ?")&&$.post("/submit_rename_subtitle",{subcat:a,newname:b},function(a){delayReload()})}
function saveState(){toInt=function(a){return parseInt($(a).attr("index"))};sublist=function(a){return $("li[tindex="+a+"]").map(function(a,c){return toInt(c)}).toArray()};title_nb=$("li[name=catlist]").map(function(a,b){return{t:toInt(b),s:sublist(toInt(b))}}).toArray();confirm("Voulez-vous vraiment enregistrer les changement effectu\u00e9s ?")&&$.post("/submit_update_titles",{nbt:title_nb.length,titles:title_nb},function(a){delayReload()});return title_nb}
function escapeSelector(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}function genStat(){var a=$("#ysel").val(),b=$("#msel").val();window.location.href="/stat_csv?m="+b+"&y="+a}function drawit(a,b,c,d,e,f){Flotr.draw(document.getElementById(a),[b],{bars:{show:!0,horizontal:!0,shadowSize:0,barWidth:0.8},mouse:{},yaxis:{min:0,noTicks:e,autoscaleMargin:1,tickFormatter:function(a){return 0<=a&&a<d.length&&a==parseInt(a)?d[parseInt(a)]:""}},xaxis:{min:0,max:f,tickDecimals:0}})}
function checkChanges(){var a=$("#saveButton");return!(0==a.length?0:-1==a.attr("class").indexOf("disabled"))||confirm("Voulez-vous vraiment annuler les changements effectu\u00e9s?")}
function setAndMayToggle(a,b){var c=$(a),d=c.children();if(0!=c.length&&0!=d.length){var e=!d.prop("checked");d.prop("checked",e);var d=b+"Clear",f=b+"Selected",k=b+"Registered",g=b+"Unselected",l=b+"Priority",m=b+"PrioritySelected",h=c.attr("class");if(h==l||h==m)c.attr("class",e?m:l);else if(h==d||h==f)c.attr("class",e?f:d);else if(h==g||h==k){if("register"==b&&e){c.attr("class",g);return}c.attr("class",e?g:k)}c=$("#saveButton").attr("class").replace("disabled","");$("#saveButton").attr("class",
c)}}function fireLine(a){$(a).parent().children("td").each(function(a,c){c.click()})}function fireCol(a,b){for(var c=a;c<42*b;c+=b)$("#b"+c).click()}function fireTitle(a,b,c){for(i=a;i<c+a;i++)fireCol(i,b)}function fireWeek(a){$(a).parent().parent().children("tr").children(".dayClick").each(function(a,c){c.click()})}function changeLock(a){$.post(a,get_my(),function(a){window.location.reload()})}
function click_cell(a,b,c,d){var e=$(a),f=get_all_users(),k=e.children().html();a=$("#selectedcell");var g=a.offset(),l=e.outerHeight(),m=e.outerWidth(),h=e.offset().left,r=e.offset().top,e=e.parent().offset().left+e.parent().outerWidth();if(g.left!=h&&g.left+a.outerWidth()!=h+m||g.top!=r+l){$("#selectedcell #userlist").remove();for(var g=$("<ul></ul>").attr("id","userlist"),s=$("<li></li>"),p=$("<select></select>"),t=!0,n=0;n<f.length;n++){var q=$("<option></option>");f[n][1]==k&&(q.attr("selected",
"selected"),t=!1);"admin"!=f[n][0]&&(q.text(f[n][1]),p.append(q))}f=$("<option></option>").text("<vide>");t&&f.attr("selected","selected");p.append(f);f=$("<select></select>").attr("id","selectof0");p.children().sort(function(a,b){return a.innerHTML.toLowerCase()>b.innerHTML.toLowerCase()?1:-1}).appendTo(f);s.append(f);g.append(s);b="submit_changes("+b+',"'+c+'","'+d+'");';b=$("<input>").attr("type","submit").attr("value","Sauver").attr("id","submit_changes").attr("onclick",b);g.append(b);a.append(g);
b=0;0<h+a.outerWidth()-e&&(b=m-a.outerWidth());a.css("position","absolute").offset({top:r+l,left:h+b})}else a.css("position","fixed").offset({top:-9E3,left:-9E3})}function submit_changes(a,b,c){for(var d=get_all_users(),e=get_my(),f="",k=$("#selectof0 :selected").val(),g=0;g<d.length;g++)if(k==d[g][1]){f=d[g][0];break}$.post("/submit_updateregistrations",{m:e.m,y:e.y,d:a,t:b,s:c,u:f},function(a){window.location.reload()})}
$(function(){var a=$("#linesUsed");$("#misc").keydown(function(b){newLines=$(this).val().split("\n").length;a.text(newLines);if(13==b.keyCode&&10<=newLines)return!1})});
function set_gencal_submits(a){var b=get_my();$("#mselect").val(b.m);$("#yselect").val(b.y);$("#freetext").submit(function(a){a.preventDefault();$.post("/submit_freetext",{m:b.m,y:b.y,t:$("#misc").val()},function(a){a="ok"==a?"#aaffaa":"ffaaaa";$("#misc").css("background-color",a)})});$("#submit_calendar").submit(function(c){c.preventDefault();if("lock"==a){c="/submit_lock";var d=".lockSelected,.lockPrioritySelected",e=".lockUnselected,.lockPriorityUnselected"}else"priority"==a?(c="/submit_priority",
d=".prioritySelected,.priorityPriorityUnselected",e=".priorityUnselected,.priorityPrioritySelected"):(c="/submit_calendar",d=".registerSelected,.registerPrioritySelected",e="");var f=function(a,b){return $(b).attr("id")},k=function(a,b){return parseInt($(b).attr("id").slice(1))},d=$(d).filter(f).map(k).toArray(),e=$(e).filter(f).map(k).toArray();$.post(c,{m:b.m,y:b.y,a:d,d:e},function(a){""!=a&&alert(a);window.location.reload()}).fail(function(a){403==a.status?alert("Vous n'avez pas les droits suffisants pour cette action"):
alert("Erreur 1")})})}function export_calendar(){var a=get_my();window.location.href="/calendar_csv?m="+a.m+"&y="+a.y};
